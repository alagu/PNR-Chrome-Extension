<script src="http://code.jquery.com/jquery-1.4.2.js"></script>
<script>
  function onRequest(request, sender, callback) {
    if (request.action == 'getJSON') {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", request.url, true);
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
          var resp = xhr.responseText;
          callback(resp);
        }
      }
      xhr.send();
    }
    else if ( request.action == 'storePNR')
    {
       var pnrnum = localStorage['pnrnum']; 

       pnrnum = pnrnum ? pnrnum.split(',') : [];

       var num = request.pnr_num_store + '';

       if(num.length == 10 && pnrnum.indexOf(num) == -1)
       {
         pnrnum.push(num);
       }

       localStorage['pnrnum'] = pnrnum.join(',');
       
       callback(num);
    }

  }
    chrome.extension.onRequest.addListener(onRequest);
</script>
